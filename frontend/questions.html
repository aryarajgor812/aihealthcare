<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancer Risk Calculator - Questionnaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhai+2:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            font-family: 'Baloo Bhai 2', cursive;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 20px;
        }

        .hero {
            padding: 20px 0 30px;
            text-align: center;
        }

        nav ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        nav ul li {
            margin: 5px 10px;
        }

        nav ul li a {
            color: #ffffff;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        nav ul li a:hover {
            color: #4CAF50;
        }

        .btn-github {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
            transition: background-color 0.3s ease;
        }

        .btn-github:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .footer a {
            color: #4CAF50;
            text-decoration: none;
        }

        .hero-content {
            max-width: 100%;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 2rem;
            margin: 15px 0;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1rem;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .question-card {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .question-card h4 {
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .options-list {
            list-style-type: none;
            padding-left: 0;
        }

        .options-list li {
            margin-bottom: 10px;
        }

        .form-check-label {
            font-size: 1rem;
            padding-left: 10px;
        }

        .btn-custom {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            font-size: 1rem;
            border-radius: 50px;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-block;
            border: none;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
            max-width: 300px;
        }

        .btn-custom:hover {
            background-color: #45a049;
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        #answer {
            font-size: 1rem;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 98%;
            background-color: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }

        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
        }

        .loading-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 1.8rem;
            }

            .hero p {
                font-size: 0.9rem;
            }

            .question-card {
                padding: 15px;
            }

            .question-card h4 {
                font-size: 1.1rem;
            }

            .form-check-label {
                font-size: 0.9rem;
            }

            .btn-custom {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body>
    <div class="hero">
        <div class="container">
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="#">Try Now</a></li>
                    <li><a href="guidance.html">Guidance</a></li>
                    <li><a href="profile.html">My Profile</a></li>
                    <li><a href="https://github.com/princejoshi12/cancer-risk-calculator" class="btn-github">Github</a>
                    </li>
                    <li>
                        <select id="language-selector" onchange="changeLanguage()">
                            <option value="en">English</option>
                            <option value="gu">Gujarati</option>
                        </select>
                    </li>
                </ul>
            </nav>
            <div class="hero-content">
                <h1>Cancer risk calculator</h1>
                <p>Answer the following questions to assess your personal risk</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="question-container" class="question-card"></div>
        <button id="submit-btn" class="btn-custom" onclick="calculateRisk()" style="display: none;">Submit
            answers</button>
    </div>

    <div class="loading">
        <div class="loading-content">
            <div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Made by <a href="https://aryarajgor.netlify.app/" target="_blank">Arya</a></p>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // WARNING: It is not recommended to store API keys in client-side code.
        // This is done for demonstration purposes only.
        const API_KEY = 'AIzaSyDQiyvx6SaLHzHYB0Bupz6SpJk4Dxgc-1I';
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro-latest:generateContent?key=${API_KEY}`;

        let questionIndex = 0;
        let questions = [];
        let answers = [];
        let selectedLanguage = localStorage.getItem('language') || 'en';

        function changeLanguage() {
            selectedLanguage = $('#language-selector').val();
            localStorage.setItem('language', selectedLanguage);
            location.reload();
        }

        function generateQuestions() {
            showLoading();
            let prompt = "You are an AI specialized in asking health-related questions to assess cancer risk. Your task is to create a series of personalized and easy-to-understand questions to learn about the user's habits, lifestyle, medical history, and environmental exposures. Think of these questions as something a friendly and empathetic doctor would ask. Make sure the questions are straightforward and personalized. Use simple and easy words that can be understood by a 10-year-old child. Minimize grammatical mistakes. Make sure the questions are detailed and clear. The questions should be divided into four stages: 1. **Basic Information:** Gather essential details like age, gender, location, and race/ethnicity, with options where appropriate. 2. **Health Habits:** Explore critical health behaviors, including smoking, alcohol consumption, diet, physical activity, and sleep patterns. 3. **Specific Risks:** Ask about family medical history, previous diagnoses, exposure to harmful substances (e.g., radiation, carcinogens), stress levels, and any chronic conditions. 4. **Screening and Diagnostic Tests:** Inquire about results from previous cancer screenings, findings from imaging tests (e.g., mammograms, colonoscopies), and relevant biomarker levels. Provide options only where it makes sense (like for age, gender, etc.), and use open-ended questions for more detailed responses (like lifestyle or medical history). Also, ask for the user's name to personalize the interaction. Format the response in JSON without markdown. Structure it like this: {questions: [{question: \"What is your age?\", \"type\": \"open-ended\"}, {question: \"What is your gender?\", options: [\"Male\", \"Female\", \"Other\"], \"type\": \"single-choice\"}]}";

            if (selectedLanguage === 'gu') {
                prompt += "\n\nTranslate the questions and options to Gujarati.";
            }

            fetch(GEMINI_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    "contents": [{
                        "parts": [{
                            "text": prompt
                        }]
                    }]
                })
            })
                .then(response => response.json())
                .then(data => {
                    const responseText = data.candidates[0].content.parts[0].text;
                    const cleanedJsonString = responseText.replace(/```json/g, '').replace(/```/g, '').trim();
                    questions = JSON.parse(cleanedJsonString).questions;
                    showQuestion();
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error:', error);
                    hideLoading();
                    alert('An error occurred while loading questions. Please try again.');
                });
        }

        $(document).ready(function () {
            $('#language-selector').val(selectedLanguage);
            generateQuestions();
        });

        function showQuestion() {
            if (questionIndex < questions.length) {
                const questionData = questions[questionIndex];
                let questionHtml = `<h4>${questionData.question}</h4>`;

                if (questionData.options && questionData.options.length > 0) {
                    questionHtml += '<ul class="options-list">';
                    questionData.options.forEach((option, index) => {
                        questionHtml += `
                    <li>
                        <div class="form-check">
                            <input class="form-check-input" type="${questionData.type === 'multiple-choice' ? 'checkbox' : 'radio'}" name="answer" id="option-${index}" value="${option}">
                            <label class="form-check-label" for="option-${index}">${option}</label>
                        </div>
                    </li>
                `;
                    });
                    questionHtml += '</ul>';
                } else {
                    questionHtml += `<input type="text" id="answer" class="form-control">`;
                }

                questionHtml += `<button class="btn-custom mt-3" onclick="submitAnswer()">Next</button>`;
                $('#question-container').html(questionHtml);
            } else {
                callApisAndProceed();
            }
        }

        function submitAnswer() {
            let answer;

            if (questions[questionIndex].options && questions[questionIndex].options.length > 0) {
                const selectedOptions = [];
                $('input[name="answer"]:checked').each(function () {
                    selectedOptions.push($(this).val());
                });

                if (selectedOptions.length > 0) {
                    answer = selectedOptions;
                } else {
                    alert("Please select an option before proceeding.");
                    return;
                }
            } else {
                answer = $('#answer').val();
                if (!answer) {
                    alert("Please reply before proceeding.");
                    return;
                }
            }

            answers.push({ question: questions[questionIndex].question, answer: answer });
            questionIndex++;
            showQuestion();
        }

        function callApisAndProceed() {
            showLoading();

            let summarizePrompt = `You are an AI specialized in summarizing user-provided health information to generate a concise, easy-to-understand summary.
Based on the user's responses to health-related questions, create a short summary that highlights the most important details about their habits, lifestyle, medical history, and cancer risk factors.
The summary should be informative but concise, covering key aspects such as age, gender, health habits, specific risks, and any previous screenings or diagnostic test results.
Use simple and easy words that can be understood by a 10-year-old child. Minimize grammatical mistakes. Make sure the summary is clear and accurate.
Generate the response in English. User Answers: ${JSON.stringify(answers)}`;

            if (selectedLanguage === 'gu') {
                summarizePrompt += "\n\nTranslate the summary to Gujarati.";
            }

            fetch(GEMINI_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ "contents": [{ "parts": [{ "text": summarizePrompt }] }] })
            })
                .then(response => response.json())
                .then(data => {
                    const summary = data.candidates[0].content.parts[0].text;
                    localStorage.setItem('user_summary', summary);

                    let riskPrompt = `You are an AI specialized in accurately assessing cancer risk based on a wide range of detailed user responses.
Your role is to carefully analyze the user's answers concerning their habits, lifestyle, medical history, environmental exposures, and diagnostic test results.
Consider genetic factors, lifestyle choices, demographic characteristics, environmental exposures, and results from screenings or diagnostic tests.
Provide a nuanced risk level (very low, low, moderate, high, very high) with a precise percentage, ranging from 1% to 100%.
The risk level and percentage should accurately reflect the user's responses, with each factor carefully weighed.
If the risk is high or very high, give special attention to the seriousness of the situation but do so in a balanced and supportive manner.
Use simple and easy words that can be understood by a 10-year-old child. Minimize grammatical mistakes. Make sure the explanation is detailed, accurate, and clear.
Generate the response in English.
Begin the response with the cancer risk level and percentage. User Answers: ${JSON.stringify(answers)}`;

                    if (selectedLanguage === 'gu') {
                        riskPrompt += "\n\nTranslate the risk assessment to Gujarati.";
                    }

                    return fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ "contents": [{ "parts": [{ "text": riskPrompt }] }] })
                    });
                })
                .then(response => response.json())
                .then(data => {
                    const riskAssessment = data.candidates[0].content.parts[0].text;
                    localStorage.setItem('risk_assessment', riskAssessment);
                    localStorage.setItem('user_answers', JSON.stringify(answers));
                    hideLoading();
                    window.location.href = 'guidance.html';
                })
                .catch(error => {
                    console.error('Error:', error);
                    hideLoading();
                    alert('An error occurred while making an API call. Please try again.');
                });
        }

        function showLoading() {
            $('.loading').fadeIn(300);
        }

        function hideLoading() {
            $('.loading').fadeOut(300);
        }
    </script>
</body>
</html>