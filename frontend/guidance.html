<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancer Risk Calculator - Guidance</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhai+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Baloo Bhai 2', cursive;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: #ffffff;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .hero {
            padding: 40px 0 80px;
            text-align: center;
        }
        nav ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }
        nav ul li {
            margin: 0 15px;
        }
        nav ul li a {
            color: #ffffff;
            text-decoration: none;
            font-size: 1rem;
            transition: color 0.3s ease;
        }
        nav ul li a:hover {
            color: #4CAF50;
        }
        .btn-github {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            transition: background-color 0.3s ease;
        }
        .btn-github:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .footer a {
            color: #4CAF50;
            text-decoration: none;
        }
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }
        .hero h1 {
            font-size: 3rem;
            margin: 20px 0;
            line-height: 1.2;
        }
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 40px;
            opacity: 0.8;
        }
        .guidance-content {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            margin-top: -5rem;
            margin-bottom: 50px;
        }
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
        }
        .loading-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }
    </style>
</head>
<body>
    <div class="hero">
        <div class="container">
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="questionnaire.html">Try Now</a></li>
                    <li><a href="#">Guidance</a></li>
                    <li><a href="profile.html">My Profile</a></li>
                    <li><a href="https://github.com/princejoshi12/cancer-risk-calculator" class="btn-github">Github</a></li>
                    <li>
                        <select id="language-selector" onchange="changeLanguage()">
                            <option value="en">English</option>
                            <option value="gu">Gujarati</option>
                        </select>
                    </li>
                </ul>
            </nav>
            <div class="hero-content">
                <h1>Your personal health guide</h1>
                <p>Tailored guidance based on answers to your questions and personal information</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="guidance-container" class="guidance-content"></div>
    </div>

    <div class="loading">
        <div class="loading-content">
            <div class="spinner-border text-light" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Made by <a href="https://aryarajgor.netlify.app/" target="_blank">Arya</a></p>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>
    <script>
        // WARNING: It is not recommended to store API keys in client-side code.
        // This is done for demonstration purposes only.
        const API_KEY = 'AIzaSyDQiyvx6SaLHzHYB0Bupz6SpJk4Dxgc-1I';
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro-latest:generateContent?key=${API_KEY}`;
        let selectedLanguage = localStorage.getItem('language') || 'en';

        function changeLanguage() {
            selectedLanguage = $('#language-selector').val();
            localStorage.setItem('language', selectedLanguage);
            location.reload();
        }

        function getPersonalizedGuidance() {
            const riskAssessment = localStorage.getItem('risk_assessment');
            const userAnswers = localStorage.getItem('user_answers');

            if (!riskAssessment || !userAnswers) {
                $('#guidance-container').html('<p>Sorry, no information available. Please complete the questionnaire first.</p>');
                return;
            }

            showLoading();

            let prompt = `You are an AI that provides highly personalized health advice to reduce cancer risk.
Based on the user's specific cancer risk assessment, their detailed answers, and the identified risk factors,
create a comprehensive and actionable health plan that is truly personalized.
For low-risk users, suggest activities that maintain or improve their good habits, and provide encouragement.
For moderate-risk users, suggest actionable changes in diet, lifestyle, and screenings, with a focus on preventing escalation.
For high-risk users, give detailed, specific advice tailored to their unique situation. This includes targeted lifestyle changes, precise dietary advice,
and urgent recommendations for further screenings or consultations. Acknowledge positive actions they are already taking.
Avoid general suggestions; instead, focus on practical steps they can directly implement. Be supportive and avoid creating undue fear, but be clear about the importance of the advice.
Use simple and easy words that can be understood by a 10-year-old child. Minimize grammatical mistakes. Make sure the guidance is clear, actionable, and highly personalized.
If the user has a high-risk chance, give them deeper and better guidance to improve their health.
Generate the response in English.
Start the response with the cancer risk stage and percentage.
Cancer Risk: ${riskAssessment}
User Answers: ${userAnswers}`;

            if (selectedLanguage === 'gu') {
                prompt += "\n\nTranslate the guidance to Gujarati.";
            }

            fetch(GEMINI_API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ "contents": [{ "parts": [{ "text": prompt }] }] })
            })
                .then(response => response.json())
                .then(data => {
                    const guidance = data.candidates[0].content.parts[0].text;
                    const converter = new showdown.Converter();
                    const htmlContent = converter.makeHtml(guidance);
                    $('#guidance-container').html(htmlContent);

                    localStorage.setItem('personalized_guidance', guidance);

                    hideLoading();
                })
                .catch(error => {
                    console.error('Error:', error);
                    hideLoading();
                    alert('Error loading guide. Please try again.');
                });
        }

        function translateStaticText() {
            if (selectedLanguage === 'gu') {
                const elementsToTranslate = $('h1, p, a.btn-github, a[href="index.html"], a[href="questions.html"], a[href="guidance.html"], a[href="profile.html"]');
                elementsToTranslate.each(function () {
                    const element = $(this);
                    const text = element.text();
                    const prompt = `Translate the following text to Gujarati: ${text}`;
                    fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ "contents": [{ "parts": [{ "text": prompt }] }] })
                    })
                        .then(response => response.json())
                        .then(data => {
                            const translatedText = data.candidates[0].content.parts[0].text;
                            element.text(translatedText);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                });
            }
        }

        $(document).ready(function () {
            $('#language-selector').val(selectedLanguage);
            translateStaticText();
            const personalizedGuidance = localStorage.getItem('personalized_guidance');

            if (personalizedGuidance) {
                const converter = new showdown.Converter();
                const htmlContent = converter.makeHtml(personalizedGuidance);
                $('#guidance-container').html(htmlContent);
            } else {
                getPersonalizedGuidance();
            }
        });

        function showLoading() {
            $('.loading').fadeIn(300);
        }

        function hideLoading() {
            $('.loading').fadeOut(300);
        }
    </script>
</body>
</html>